<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin User Management - Expense System</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; font-family: sans-serif; }
body { background-color:#f4f4f9; padding:20px; }
.page-container { max-width:1200px; margin:0 auto; background:#fff; border-radius:8px; padding:20px; box-shadow:0 4px 6px rgba(0,0,0,0.1);}
h1,h2 { margin-bottom:15px; color:#333; }
.form-group { margin-bottom:15px; }
.form-group label { display:block; font-weight:bold; margin-bottom:5px; color:#333; }
.form-group input, .form-group select { width:100%; padding:10px; border:1px solid #ccc; border-radius:4px; }
.btn { padding:10px 15px; border:none; border-radius:4px; cursor:pointer; transition:0.2s; }
.primary-btn { background:#007bff; color:white; }
.primary-btn:hover { background:#0056b3; }
.report-table-container { overflow-x:auto; margin-top:20px; }
table { width:100%; border-collapse:collapse; }
table th, table td { padding:12px 15px; text-align:left; border-bottom:1px solid #ddd; }
table th { font-weight:600; color:#333; }
table thead th { background:#007bff; color:white; }
table tbody tr:hover { background:#f1f1f1; }
.action-btn { background:#ffc107; color:#333; margin-right:5px; }
.action-btn:hover { background:#e0a800; }
.delete-btn { background:#dc3545; color:white; }
.delete-btn:hover { background:#c82333; }
.status-pending { color:#ffc107; font-weight:bold; }
.status-sent { color:green; font-weight:bold; }
.form-row { display:flex; gap:15px; }
.form-row .form-group { flex-grow:1; }
.add-user-btn-container { text-align:right; margin-top:15px; }
</style>
</head>
<body>
<div class="page-container">
<h1>User Management Overview</h1>
<hr>
<form id="addUserForm">
<h2>Add New User</h2>
<div class="form-row">
    <div class="form-group">
        <label for="new-name">Full Name</label>
        <input type="text" id="new-name" placeholder="Enter Full Name" required>
    </div>
    <div class="form-group">
        <label for="new-email">Email Address</label>
        <input type="email" id="new-email" placeholder="Enter Email" required>
    </div>
    <div class="form-group" style="max-width:200px;">
        <label for="new-role">Role</label>
        <select id="new-role">
            <option value="Employee">Employee</option>
            <option value="Manager">Manager</option>
        </select>
    </div>
</div>
<div class="add-user-btn-container">
    <button type="submit" class="btn primary-btn" id="provision-btn">Provision Account & Send Password</button>
</div>
</form>
<hr style="margin-top:20px;">
<div class="report-table-container">
<table>
<thead>
<tr>
<th>User ID</th>
<th>Full Name</th>
<th>Email Address</th>
<th>Role</th>
<th>Status</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="userTableBody">
<tr id="empty-row">
<td colspan="6" style="text-align:center;color:#999;">No users found. Add the first user above.</td>
</tr>
</tbody>
</table>
</div>
</div>
<script>
let users = JSON.parse(localStorage.getItem('users')) || [];
let userCounter = users.length;

function renderTable() {
    const tableBody = document.getElementById('userTableBody');
    tableBody.innerHTML='';
    
    if(users.length===0){
        tableBody.innerHTML='<tr id="empty-row"><td colspan="6" style="text-align:center;color:#999;">No users found. Add the first user above.</td></tr>';
        return;
    }
    
    users.forEach(u=>{
        // CORRECTION: Use backticks (`) for the template literal string
        tableBody.insertAdjacentHTML('beforeend',`
            <tr data-id="${u.id}">
                <td>${u.id}</td>
                <td>${u.name}</td>
                <td>${u.email}</td>
                <td><strong>${u.role}</strong></td>
                <td><span class="${u.status==='Pending'?'status-pending':'status-sent'}">${u.status}</span></td>
                <td>
                    <button class="btn action-btn">${u.status==='Pending'?'Send Invitation':'Resend Invitation'}</button>
                    <button class="btn delete-btn">Delete</button>
                </td>
            </tr>
        `);
    });
}

function saveUsers(){ localStorage.setItem('users',JSON.stringify(users)); }

document.getElementById('addUserForm').addEventListener('submit',function(e){
    e.preventDefault();
    const name=document.getElementById('new-name').value.trim();
    const email=document.getElementById('new-email').value.trim();
    const role=document.getElementById('new-role').value;
    
    if(!name||!email){ alert("Please enter both name and email."); return; }
    const emailPattern=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if(!emailPattern.test(email)){ alert("Please enter a valid email."); return; }
    if(users.some(u=>u.email.toLowerCase()===email.toLowerCase())){ alert("This email is already registered."); return; }
    
    userCounter++;
    const id=(role==='Manager'?'MGR':'EMP')+String(userCounter).padStart(3, '0'); // Pad with 0s for neatness
    
    users.push({id,name,email,role,status:'Pending'});
    saveUsers();
    renderTable();
    
    document.getElementById('new-name').value=''; 
    document.getElementById('new-email').value=''; 
    document.getElementById('new-role').value='Employee'; 
    document.getElementById('new-name').focus();
});

document.getElementById('userTableBody').addEventListener('click',function(e){
    const row=e.target.closest('tr');
    if(!row||row.id==='empty-row') return;
    
    const userId=row.getAttribute('data-id');
    const idx=users.findIndex(u=>u.id===userId);
    
    if(e.target.classList.contains('delete-btn')){
        if(confirm("Are you sure you want to delete this user?")){ 
            users.splice(idx,1); 
            saveUsers(); 
            renderTable(); 
        }
    }
    
    if(e.target.classList.contains('action-btn')){
        users[idx].status='Sent';
        saveUsers();
        renderTable();
        alert(`Invitation sent to ${users[idx].email}`);
    }
});

renderTable();
</script>
</body>
</html>
